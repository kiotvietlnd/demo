<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chiến Thần Thuế - KiotViet Ultra Rumble</title>
    
    <!-- React & ReactDOM từ CDN -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel để dịch JSX sang Javascript -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        body { margin: 0; overflow: hidden; background-color: #0f172a; color: white; font-family: 'Courier New', Courier, monospace; }
        @keyframes float { 0% { transform: translateY(0px); } 50% { transform: translateY(-20px); } 100% { transform: translateY(0px); } }
        @keyframes wave { 0% { d: path("M40 100 Q20 120 10 100"); } 50% { d: path("M40 100 Q20 80 10 100"); } 100% { d: path("M40 100 Q20 120 10 100"); } }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-5px); } 75% { transform: translateX(5px); } }
        
        .cursor-crosshair { cursor: crosshair; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- Bộ Icon SVG (Thay thế Lucide-React để chạy trực tiếp) ---
        const Icon = ({ path, className, color }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke={color || "currentColor"} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                {path}
            </svg>
        );

        const Icons = {
            Shield: <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z" />,
            Sword: <path d="M14.5 17.5L3 6V3h3l11.5 11.5" />, // Simplified sword
            AlertTriangle: <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0zM12 9v4m0 4h.01" />,
            Trophy: <path d="M8 21h8m-4-9v9m-4.8-9a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm9.6 0a3 3 0 1 1 0-6 3 3 0 0 1 0 6z" />
        };

        // --- Main App Component ---
        const App = () => {
             // --- Game Data ---
            const questions = [
                {
                q: "Tờ khai thuế 'huyền thoại' cho Hộ kinh doanh là mẫu nào?",
                a: [
                    { text: "Mẫu 01/CNKD", isCorrect: true, power: 15, rationale: "CHUẨN! Đây là vũ khí tối thượng của chủ shop!" },
                    { text: "Mẫu 007/BOND", isCorrect: false, damage: 20, rationale: "Sai rồi! Điệp viên 007 không giúp bạn nộp thuế đâu!" },
                    { text: "Mẫu Tùy-Hỷ", isCorrect: false, damage: 20, rationale: "Thuế không phải hòm công đức nha bạn ơi!" },
                    { text: "Mẫu Giấy Nháp", isCorrect: false, damage: 20, rationale: "Viết nháp thì ai nhận? Phải đúng mẫu 01/CNKD!" }
                ]
                },
                {
                q: "Combo thuế ngành Bán lẻ là bao nhiêu %?",
                a: [
                    { text: "1.5% (1% GTGT + 0.5% TNCN)", isCorrect: true, power: 20, rationale: "QUÁ ĐỈNH! Con số vàng trong làng nộp thuế!" },
                    { text: "100% (Làm vì đam mê)", isCorrect: false, damage: 25, rationale: "Nộp hết thì cạp đất mà ăn à? Sai rồi!" },
                    { text: "50% (Chia đôi cơn mơ)", isCorrect: false, damage: 25, rationale: "Chia đôi tài sản thế này thì sập tiệm sớm!" },
                    { text: "0% (Tàng hình)", isCorrect: false, damage: 25, rationale: "Bạn không tàng hình trước cơ quan thuế được đâu!" }
                ]
                },
                {
                q: "Doanh thu tính thuế được tính như thế nào?",
                a: [
                    { text: "Doanh thu tổng (chưa trừ chi phí)", isCorrect: true, power: 15, rationale: "CHÍNH XÁC! Dòng tiền vào là tính thuế ngay!" },
                    { text: "Doanh thu trừ tiền ăn sáng", isCorrect: false, damage: 20, rationale: "Ăn sáng tôm hùm thì âm vốn mất! Sai nha!" },
                    { text: "Tiền còn trong túi quần", isCorrect: false, damage: 20, rationale: "Túi quần thủng thì sao? Phải tính trên hóa đơn chứ!" },
                    { text: "Số mình thích", isCorrect: false, damage: 20, rationale: "Thích thì nhích, nhưng nhích vào... danh sách phạt đấy!" }
                ]
                },
                {
                q: "Định dạng file nộp thuế online chuẩn nhất?",
                a: [
                    { text: "XML (eXtensible Markup Language)", isCorrect: true, power: 15, rationale: "XML MUÔN NĂM! KiotViet xuất cái này siêu mượt!" },
                    { text: "MP3 (Nhạc remix)", isCorrect: false, damage: 15, rationale: "Gửi nhạc cho cán bộ thuế quẩy à? Sai!" },
                    { text: "JPG (Ảnh selfie)", isCorrect: false, damage: 15, rationale: "Thuế không cần ngắm dung nhan của bạn đâu!" },
                    { text: "EXE (Virus)", isCorrect: false, damage: 30, rationale: "Định hack cơ quan thuế hả? Gan to đấy!" }
                ]
                },
                {
                    q: "Hạn chót nộp tờ khai quý là khi nào?",
                    a: [
                    { text: "Ngày cuối tháng đầu quý sau", isCorrect: true, power: 20, rationale: "TUYỆT VỜI! Ghi nhớ mốc này để không bị phạt!" },
                    { text: "Mùng 1 Tết", isCorrect: false, damage: 20, rationale: "Tết để chơi, không ai nhận tờ khai đâu!" },
                    { text: "Khi nào vui thì nộp", isCorrect: false, damage: 20, rationale: "Thuế cần KỶ LUẬT, không cần cảm xúc!" },
                    { text: "Ngày tận thế", isCorrect: false, damage: 20, rationale: "Lúc đó thì cần gì tiền nữa mà nộp!" }
                    ]
                },
                {
                    q: "Doanh thu dưới bao nhiêu thì được MIỄN thuế?",
                    a: [
                    { text: "Dưới 100 triệu/năm", isCorrect: true, power: 25, rationale: "CHÍNH XÁC! Nhà nước nuôi dưỡng nguồn thu mà!" },
                    { text: "Dưới 1 tỷ/năm", isCorrect: false, damage: 25, rationale: "1 tỷ mà miễn thì ai cũng muốn làm hộ kinh doanh!" },
                    { text: "Dưới 500k/năm", isCorrect: false, damage: 25, rationale: "500k thì mua trà sữa hết rồi, kinh doanh gì!" },
                    { text: "Không bao giờ miễn", isCorrect: false, damage: 25, rationale: "Có ngưỡng miễn nha, đừng bi quan thế!" }
                    ]
                },
                {
                    q: "KiotViet giúp gì cho việc kê khai thuế?",
                    a: [
                    { text: "Tự động tổng hợp Hóa đơn", isCorrect: true, power: 15, rationale: "CHUẨN KHÔNG CẦN CHỈNH! Không lo cộng tay sai số!" },
                    { text: "Tự động trốn thuế", isCorrect: false, damage: 50, rationale: "Bậy bạ! KiotViet tuân thủ pháp luật nha!" },
                    { text: "Tự động in tiền", isCorrect: false, damage: 20, rationale: "Ước gì được thế! Nhưng KiotViet chỉ quản lý tiền thôi." },
                    { text: "Làm máy tính nổ tung", isCorrect: false, damage: 20, rationale: "Phần mềm nhẹ hều à, nổ sao được!" }
                    ]
                },
                {
                    q: "Nộp tờ khai sai thì làm sao?",
                    a: [
                    { text: "Nộp tờ khai bổ sung", isCorrect: true, power: 15, rationale: "ĐÚNG! Sai thì sửa, chửa thì đẻ, luật cho phép!" },
                    { text: "Đập máy tính", isCorrect: false, damage: 30, rationale: "Máy tính vô tội! Đừng giận cá chém thớt!" },
                    { text: "Đổi tên đổi họ trốn đi", isCorrect: false, damage: 30, rationale: "Mã số thuế đi theo cả đời, chạy đâu cho thoát!" },
                    { text: "Khóc lóc van xin", isCorrect: false, damage: 20, rationale: "Nước mắt không giải quyết được vấn đề hành chính!" }
                    ]
                }
            ];

            // --- States ---
            const [gameState, setGameState] = useState('start'); 
            const [qIdx, setQIdx] = useState(0);
            const [bossHp, setBossHp] = useState(100);
            const [heroHp, setHeroHp] = useState(100);
            const [combo, setCombo] = useState(0);
            const [ultCharge, setUltCharge] = useState(0); // 0-100
            const [shake, setShake] = useState(0);
            const [flash, setFlash] = useState(false);
            const [particles, setParticles] = useState([]);
            const [floatText, setFloatText] = useState([]);
            const [feedback, setFeedback] = useState(null);
            const [bgOffset, setBgOffset] = useState(0);

            // --- Audio Engine ---
            const audioCtx = useRef(null);

            const initAudio = () => {
                if (!audioCtx.current) audioCtx.current = new (window.AudioContext || window.webkitAudioContext)();
                if (audioCtx.current.state === 'suspended') audioCtx.current.resume();
            };

            const playSound = (type) => {
                if (!audioCtx.current) return;
                const ctx = audioCtx.current;
                const t = ctx.currentTime;
                const osc = ctx.createOscillator();
                const gain = ctx.createGain();
                osc.connect(gain);
                gain.connect(ctx.destination);

                if (type === 'hit') {
                    // Laser Zap
                    osc.type = 'sawtooth';
                    osc.frequency.setValueAtTime(800, t);
                    osc.frequency.exponentialRampToValueAtTime(100, t + 0.2);
                    gain.gain.setValueAtTime(0.3, t);
                    gain.gain.exponentialRampToValueAtTime(0.01, t + 0.2);
                    osc.start(t); osc.stop(t + 0.2);
                } else if (type === 'error') {
                    // Glitch Buzz
                    osc.type = 'square';
                    osc.frequency.setValueAtTime(150, t);
                    osc.frequency.linearRampToValueAtTime(100, t + 0.1);
                    osc.frequency.linearRampToValueAtTime(150, t + 0.2);
                    gain.gain.setValueAtTime(0.3, t);
                    gain.gain.exponentialRampToValueAtTime(0.01, t + 0.4);
                    osc.start(t); osc.stop(t + 0.4);
                } else if (type === 'ult') {
                    // Power Up Rise
                    osc.type = 'triangle';
                    osc.frequency.setValueAtTime(200, t);
                    osc.frequency.exponentialRampToValueAtTime(1500, t + 1);
                    gain.gain.setValueAtTime(0.5, t);
                    gain.gain.linearRampToValueAtTime(0, t + 1);
                    osc.start(t); osc.stop(t + 1);
                } else if (type === 'win') {
                    // Victory Arpeggio
                    const notes = [523.25, 659.25, 783.99, 1046.50, 1318.51, 1567.98];
                    notes.forEach((f, i) => {
                        const o = ctx.createOscillator();
                        const g = ctx.createGain();
                        o.type = 'square';
                        o.connect(g); g.connect(ctx.destination);
                        o.frequency.value = f;
                        g.gain.setValueAtTime(0.1, t + i*0.1);
                        g.gain.exponentialRampToValueAtTime(0.001, t + i*0.1 + 0.5);
                        o.start(t + i*0.1); o.stop(t + i*0.1 + 0.5);
                    });
                }
            };

            // --- Effects Systems ---
            const spawnParticles = (x, y, color) => {
                const newParts = Array.from({ length: 20 }).map((_, i) => ({
                id: Math.random(),
                x, y,
                vx: (Math.random() - 0.5) * 20,
                vy: (Math.random() - 0.5) * 20,
                life: 1,
                color: color || '#10b981'
                }));
                setParticles(prev => [...prev, ...newParts]);
            };

            const spawnText = (text, type) => {
                setFloatText(prev => [...prev, { id: Math.random(), text, type, life: 1 }]);
            };

            useEffect(() => {
                let animFrame;
                const loop = () => {
                setBgOffset(prev => (prev + 1) % 100);
                setParticles(prev => prev.map(p => ({
                    ...p, x: p.x + p.vx, y: p.y + p.vy, life: p.life - 0.05
                })).filter(p => p.life > 0));

                setFloatText(prev => prev.map(t => ({
                    ...t, life: t.life - 0.02
                })).filter(t => t.life > 0));

                if (shake > 0) setShake(s => Math.max(0, s - 1));
                    animFrame = requestAnimationFrame(loop);
                };
                animFrame = requestAnimationFrame(loop);
                return () => cancelAnimationFrame(animFrame);
            }, [shake]);

            // --- Logic ---
            const handleAnswer = (opt, event) => {
                if (feedback) return;
                initAudio();

                if (opt.isCorrect) {
                    playSound('hit');
                    let dmg = opt.power;
                    if (combo > 2) dmg *= 1.5; 
                    
                    setBossHp(prev => Math.max(0, prev - dmg));
                    setCombo(c => c + 1);
                    setUltCharge(u => Math.min(100, u + 25));
                    setShake(5); 
                    
                    const rect = event.target.getBoundingClientRect();
                    spawnParticles(rect.left + rect.width/2, rect.top, '#10b981');
                    spawnText(`-${Math.floor(dmg)} HP`, 'dmg');
                    if (combo > 1) spawnText(`${combo}x COMBO!`, 'combo');

                    setFeedback({ type: 'success', msg: opt.rationale });

                    if (bossHp - dmg <= 0) {
                        setTimeout(() => { playSound('win'); setGameState('won'); }, 1000);
                    }
                } else {
                    playSound('error');
                    setHeroHp(prev => Math.max(0, prev - (opt.damage || 20)));
                    setCombo(0);
                    setUltCharge(0);
                    setShake(20); 
                    setFlash(true);
                    setTimeout(() => setFlash(false), 100);
                    
                    const rect = event.target.getBoundingClientRect();
                    spawnParticles(rect.left + rect.width/2, rect.top, '#ef4444');
                    spawnText("MISS!", 'error');
                    
                    setFeedback({ type: 'error', msg: opt.rationale });

                    if (heroHp - (opt.damage || 20) <= 0) {
                        setTimeout(() => setGameState('lost'), 1000);
                    }
                }
            };

            const useUltimate = () => {
                if (ultCharge < 100) return;
                initAudio();
                playSound('ult');
                setShake(50);
                setFlash(true);
                setTimeout(() => setFlash(false), 500);
                
                const dmg = 50;
                setBossHp(prev => Math.max(0, prev - dmg));
                setUltCharge(0);
                spawnText("QUYẾT TOÁN THUẾ!!!", 'ult');
                spawnParticles(window.innerWidth/2, window.innerHeight/2, '#f59e0b');

                if (bossHp - dmg <= 0) {
                    setTimeout(() => { playSound('win'); setGameState('won'); }, 1500);
                }
            };

            const nextQ = () => {
                if (qIdx < questions.length - 1 && bossHp > 0 && heroHp > 0) {
                    setQIdx(prev => prev + 1);
                    setFeedback(null);
                } else if (bossHp > 0 && heroHp > 0) {
                    setGameState('won'); 
                }
            };

            // --- SVGs for Characters ---
            const HeroSVG = () => (
                <svg viewBox="0 0 200 200" className={`w-32 h-32 md:w-48 md:h-48 drop-shadow-[0_0_15px_rgba(16,185,129,0.8)] ${heroHp < 30 ? 'animate-pulse' : 'animate-[bounce_2s_infinite]'}`}>
                    <circle cx="100" cy="100" r="80" fill="#10b981" fillOpacity="0.2" className="animate-[ping_3s_infinite]" />
                    <path d="M70 140 L130 140 L130 180 L70 180 Z" fill="#064e3b" /> 
                    <path d="M60 90 L140 90 L130 150 L70 150 Z" fill="#10b981" />
                    <path d="M100 80 L60 80 L50 120 L70 120 Z" fill="#34d399" />
                    <path d="M100 80 L140 80 L150 120 L130 120 Z" fill="#34d399" />
                    <circle cx="100" cy="60" r="35" fill="#fcd34d" />
                    <rect x="70" y="50" width="60" height="10" fill="#000" rx="5" />
                    <path d="M65 30 L135 30 L120 10 L80 10 Z" fill="#065f46" />
                    <text x="100" y="25" fontSize="12" fill="white" textAnchor="middle" fontWeight="bold">KIOT</text>
                    <path d="M140 100 L180 60 L190 70 L150 110 Z" fill="#cbd5e1" className="animate-[pulse_0.5s_infinite]" />
                    <path d="M145 105 L135 115" stroke="#94a3b8" strokeWidth="5" />
                </svg>
            );

            const BossSVG = () => (
                <svg viewBox="0 0 200 200" className={`w-40 h-40 md:w-64 md:h-64 drop-shadow-[0_0_20px_rgba(239,68,68,0.8)] transition-all duration-300 ${shake > 0 ? 'scale-90 skew-x-12' : 'animate-[float_4s_ease-in-out_infinite]'}`}>
                    <defs>
                        <radialGradient id="bossGrad" cx="50%" cy="50%" r="50%">
                            <stop offset="0%" stopColor="#ef4444" />
                            <stop offset="100%" stopColor="#7f1d1d" />
                        </radialGradient>
                        <filter id="glitch">
                            <feTurbulence type="fractalNoise" baseFrequency="0.1" numOctaves="1" result="noise" />
                            <feDisplacementMap in="SourceGraphic" in2="noise" scale={shake > 0 ? 20 : 0} />
                        </filter>
                    </defs>
                    <g filter="url(#glitch)">
                        <path d="M40 100 Q40 40 100 40 Q160 40 160 100 Q160 160 100 160 Q40 160 40 100 Z" fill="url(#bossGrad)" />
                        <path d="M40 100 Q20 120 10 100" stroke="#7f1d1d" strokeWidth="8" fill="none" className="animate-[wave_1s_infinite]" />
                        <path d="M160 100 Q180 80 190 100" stroke="#7f1d1d" strokeWidth="8" fill="none" className="animate-[wave_1.2s_infinite]" />
                        <path d="M100 160 Q120 190 100 200" stroke="#7f1d1d" strokeWidth="8" fill="none" className="animate-[wave_0.8s_infinite]" />
                        <circle cx="80" cy="90" r="10" fill="#fff" />
                        <circle cx="80" cy="90" r="3" fill="#000" className="animate-[ping_3s_infinite]" />
                        <circle cx="120" cy="80" r="15" fill="#fff" />
                        <circle cx="120" cy="80" r="5" fill="#000" />
                        <circle cx="100" cy="60" r="8" fill="#fff" />
                        <circle cx="100" cy="60" r="2" fill="#000" />
                        <path d="M70 120 Q100 140 130 120" stroke="#000" strokeWidth="5" fill="none" />
                        <text x="50" y="150" fontSize="14" fill="white" className="font-mono">ERROR 404</text>
                    </g>
                </svg>
            );

            // --- Screens ---
            if (gameState === 'start') return (
                <div className="min-h-screen bg-black text-green-500 font-mono flex flex-col items-center justify-center relative overflow-hidden">
                    <div className="absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/dark-matter.png')] opacity-20 animate-[spin_60s_linear_infinite]"></div>
                    <div className="z-10 text-center space-y-8 p-8 border-4 border-green-500 shadow-[0_0_50px_#10b981] bg-black/80 backdrop-blur-sm rounded-xl">
                        <h1 className="text-4xl md:text-6xl font-black italic tracking-tighter text-transparent bg-clip-text bg-gradient-to-r from-green-400 to-blue-500 animate-pulse">
                            CHIẾN THẦN THUẾ
                        </h1>
                        <h2 className="text-xl md:text-2xl text-red-500 font-bold tracking-[0.5em]">ULTRA RUMBLE</h2>
                        <div className="flex justify-center gap-8">
                            <HeroSVG />
                            <div className="text-4xl font-black self-center">VS</div>
                            <BossSVG />
                        </div>
                        <button 
                            onClick={() => { initAudio(); setGameState('play'); }}
                            className="px-8 py-3 md:px-12 md:py-4 bg-green-600 hover:bg-green-400 text-black font-black text-xl md:text-2xl rounded shadow-[0_0_20px_#10b981] hover:scale-105 transition-transform"
                        >
                            INSERT COIN TO START
                        </button>
                    </div>
                </div>
            );

            if (gameState === 'won' || gameState === 'lost') return (
                <div className={`min-h-screen flex flex-col items-center justify-center p-8 text-center font-mono ${gameState === 'won' ? 'bg-green-900' : 'bg-red-900'}`}>
                    {gameState === 'won' ? (
                        <div className="animate-[bounce_1s_infinite]">
                            <Icon path={Icons.Trophy} className="text-yellow-400 mx-auto mb-4 w-24 h-24" />
                            <h1 className="text-4xl md:text-6xl font-black text-yellow-400 mb-4">VICTORY!</h1>
                            <p className="text-xl md:text-2xl text-white">Bạn là bậc thầy Tờ Khai 01/CNKD!</p>
                        </div>
                    ) : (
                        <div className="animate-pulse">
                            <Icon path={Icons.AlertTriangle} className="text-black mx-auto mb-4 w-24 h-24" />
                            <h1 className="text-4xl md:text-6xl font-black text-black mb-4">GAME OVER</h1>
                            <p className="text-xl md:text-2xl text-white">Quái vật Thuế đã nuốt chửng bạn!</p>
                        </div>
                    )}
                    <button onClick={() => window.location.reload()} className="mt-8 px-8 py-3 bg-white text-black font-bold text-xl rounded shadow-lg hover:bg-gray-200">
                        CHƠI LẠI (RESTART)
                    </button>
                </div>
            );

            // --- Main Game Loop ---
            return (
                <div 
                    className={`min-h-screen bg-slate-900 text-white font-mono overflow-hidden relative cursor-crosshair`}
                    style={{ transform: `translate(${Math.random()*shake - shake/2}px, ${Math.random()*shake - shake/2}px)` }}
                >
                    {/* Flash Effect */}
                    {flash && <div className="absolute inset-0 bg-white z-50 opacity-50 pointer-events-none"></div>}

                    {/* Dynamic Background */}
                    <div 
                        className="absolute inset-0 opacity-20 pointer-events-none"
                        style={{ 
                            backgroundImage: 'linear-gradient(0deg, transparent 24%, rgba(32, 255, 77, .3) 25%, rgba(32, 255, 77, .3) 26%, transparent 27%, transparent 74%, rgba(32, 255, 77, .3) 75%, rgba(32, 255, 77, .3) 76%, transparent 77%, transparent), linear-gradient(90deg, transparent 24%, rgba(32, 255, 77, .3) 25%, rgba(32, 255, 77, .3) 26%, transparent 27%, transparent 74%, rgba(32, 255, 77, .3) 75%, rgba(32, 255, 77, .3) 76%, transparent 77%, transparent)',
                            backgroundSize: '50px 50px',
                            transform: `translateY(${bgOffset}px) perspective(500px) rotateX(60deg)`
                        }}
                    ></div>

                    {/* Particles Layer */}
                    {particles.map(p => (
                        <div 
                            key={p.id}
                            className="absolute w-3 h-3 rounded-full pointer-events-none"
                            style={{ 
                                left: p.x, top: p.y, backgroundColor: p.color, opacity: p.life,
                                transform: `scale(${p.life})`
                            }}
                        />
                    ))}

                    {/* Float Text Layer */}
                    {floatText.map(t => (
                        <div 
                            key={t.id}
                            className={`absolute font-black text-2xl pointer-events-none z-50 ${t.type === 'dmg' ? 'text-yellow-400' : t.type === 'error' ? 'text-red-500' : 'text-blue-400 text-4xl'}`}
                            style={{ 
                                left: '50%', top: '40%', opacity: t.life,
                                transform: `translate(-50%, ${-100 * (1-t.life)}px) scale(${1 + (1-t.life)})`
                            }}
                        >
                            {t.text}
                        </div>
                    ))}

                    {/* HUD */}
                    <div className="relative z-20 p-4 flex justify-between items-start">
                        {/* Hero HUD */}
                        <div className="w-1/3">
                            <div className="flex items-center gap-2 mb-2">
                                <div className="w-12 h-12 bg-green-600 rounded-full flex items-center justify-center border-2 border-white">
                                    <Icon path={Icons.Shield} className="text-white w-6 h-6" />
                                </div>
                                <div>
                                    <div className="text-green-400 font-bold text-xs uppercase">Sơn KiotViet</div>
                                    <div className="w-32 md:w-48 h-4 bg-gray-700 rounded-full border border-green-500 overflow-hidden">
                                        <div className="h-full bg-green-500 transition-all duration-300" style={{ width: `${heroHp}%` }}></div>
                                    </div>
                                </div>
                            </div>
                            {/* Ultimate Bar */}
                            <div className="mt-2 flex items-center gap-2">
                                <span className="text-xs text-yellow-400 font-bold animate-pulse">ULTIMATE</span>
                                <div className="w-24 md:w-32 h-2 bg-gray-800 rounded-full border border-yellow-500 overflow-hidden">
                                    <div className="h-full bg-yellow-400 transition-all duration-300" style={{ width: `${ultCharge}%` }}></div>
                                </div>
                                {ultCharge >= 100 && (
                                    <button 
                                        onClick={useUltimate}
                                        className="bg-yellow-500 text-black text-xs font-black px-2 py-1 rounded animate-bounce hover:bg-white"
                                    >
                                        PRESS Z!
                                    </button>
                                )}
                            </div>
                        </div>

                        {/* VS Badge */}
                        <div className="text-center">
                            <div className="text-2xl md:text-4xl font-black italic text-red-500 drop-shadow-lg">ROUND {qIdx + 1}</div>
                            {combo > 1 && <div className="text-yellow-400 font-black text-xl md:text-2xl animate-bounce">{combo} COMBO!</div>}
                        </div>

                        {/* Boss HUD */}
                        <div className="w-1/3 flex flex-col items-end">
                            <div className="flex items-center gap-2 mb-2">
                                <div className="text-right">
                                    <div className="text-red-400 font-bold text-xs uppercase animate-pulse">Quái Vật Sai Sót</div>
                                    <div className="w-32 md:w-48 h-4 bg-gray-700 rounded-full border border-red-500 overflow-hidden">
                                        <div className="h-full bg-red-600 transition-all duration-300" style={{ width: `${bossHp}%` }}></div>
                                    </div>
                                </div>
                                <div className="w-12 h-12 bg-red-900 rounded-full flex items-center justify-center border-2 border-red-500">
                                    <Icon path={Icons.AlertTriangle} className="text-white w-6 h-6" />
                                </div>
                            </div>
                        </div>
                    </div>

                    {/* Battle Ground */}
                    <div className="relative flex justify-between items-end px-4 md:px-32 h-[30vh] md:h-[40vh] z-10">
                        <div className="relative top-10">
                            <HeroSVG />
                        </div>
                        <div className="relative top-10">
                            <BossSVG />
                        </div>
                    </div>

                    {/* Control Panel (Questions) */}
                    <div className="absolute bottom-0 left-0 right-0 bg-black/90 border-t-4 border-green-500 p-4 md:p-6 z-30 min-h-[35vh]">
                        {feedback ? (
                            <div className="text-center h-full flex flex-col items-center justify-center animate-[fadeIn_0.5s]">
                                <h2 className={`text-2xl md:text-3xl font-black mb-4 ${feedback.type === 'success' ? 'text-green-400' : 'text-red-500'}`}>
                                    {feedback.type === 'success' ? 'TUYỆT VỜI!' : 'HỎNG RỒI!'}
                                </h2>
                                <p className="text-lg md:text-xl text-white mb-6 italic">"{feedback.msg}"</p>
                                <button 
                                    onClick={nextQ}
                                    className="px-8 py-3 bg-white text-black font-black text-lg md:text-xl rounded hover:scale-110 transition-transform"
                                >
                                    TIẾP TỤC CHIẾN ĐẤU &gt;&gt;
                                </button>
                            </div>
                        ) : (
                            <>
                                <h3 className="text-lg md:text-2xl text-center font-bold text-green-400 mb-6 border-b border-green-800 pb-2">
                                    {questions[qIdx].q}
                                </h3>
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    {questions[qIdx].a.map((opt, i) => (
                                        <button
                                            key={i}
                                            onClick={(e) => handleAnswer(opt, e)}
                                            className="group relative bg-gray-800 border-2 border-gray-600 p-3 md:p-4 rounded hover:bg-green-900 hover:border-green-400 transition-all text-left"
                                        >
                                            <span className="absolute top-2 right-2 text-xs text-gray-500 group-hover:text-green-400">
                                                {String.fromCharCode(65+i)}
                                            </span>
                                            <span className="font-bold text-base md:text-lg group-hover:text-white">{opt.text}</span>
                                        </button>
                                    ))}
                                </div>
                            </>
                        )}
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
